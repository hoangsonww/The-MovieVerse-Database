<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Favorites & Watchlists - The MovieVerse</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/movie-details.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta property="og:title" content="Favorites & Watchlists - The MovieVerse" />
    <meta name="description" content="Manage your favorite movies and watchlists on The MovieVerse. Keep track of movies you love and organize your watchlists for future viewing.">
    <link rel="canonical" href="https://movie-verse.com/MovieVerse-Frontend/html/favorites.html">
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="website" />
    <meta http-equiv="content-language" content="en" />
    <meta property="og:description" content="Manage your favorite movies and watchlists on The MovieVerse. Keep track of movies you love and organize your watchlists for future viewing." />
    <meta property="og:url" content="https://movie-verse.com/MovieVerse-Frontend/html/favorites.html" />
    <meta property="og:site_name" content="The MovieVerse" />
    <meta property="og:image" content="https://movie-verse.com/images/image.png"/>
    <meta property="og:favicon" content="./images/favicon.ico" />
    <meta name="keywords" content="movies, film guide, directors, actors, movie genres, cinema, film reviews">
    <meta name="author" content="Son Nguyen Hoang">
    <meta name="robots" content="index, follow">
    <meta name="rating" content="General">
    <meta name="revisit-after" content="3 days">
    <meta name="distribution" content="global">
    <meta http-equiv="content-language" content="en">
    <script src="../js/settings.js"></script>
    <meta name="language" content="en">
    <meta name="theme-color" content="#7378c5">
    <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@MovieVerse" />
    <meta name="twitter:creator" content="@hoangsonw" />
    <meta name="twitter:title" content="Favorites & Watchlists - The MovieVerse">
    <meta name="twitter:description" content="Manage your favorite movies and watch lists on The MovieVerse. Keep track of movies you love and organize your watch lists for future viewing.">
    <meta name="twitter:image" content="https://movie-verse.com/images/image.png"/>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <script src="../js/favorites.js" type="module"></script>
    <link rel="manifest" href="../../manifest.json">
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CQKJ67FXZ4"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-CQKJ67FXZ4');
    </script>
    <style>
        @font-face {
            font-family: 'Poppins';
            src: url('https://movie-verse.com/fonts/Poppins-Light.ttf') format('truetype');
            font-weight: 200;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Poppins';
            src: url('https://movie-verse.com/fonts/Poppins-Regular.ttf') format('truetype');
            font-weight: 400;
            font-style: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Poppins';
            src: url('https://movie-verse.com/fonts/Poppins-SemiBold.ttf') format('truetype');
            font-weight: 600;
            font-style: normal;
            font-display: swap;
        }
        body {
            font-family: 'Poppins', sans-serif;
        }
        .watchlist-controls {
            position: absolute;
            top: 10px;
            display: flex;
            align-items: start;
            gap: 5px;
        }
        .watchlist-controls button {
            background: none;
            border: none;
            color: #ff8623;
            cursor: pointer;
            height: 20px;
            width: 20px;
            margin-right: 8px;
            font-size: 18px;
        }
        #create-watchlist-modal .modal-content {
            min-width: 400px;
            margin-top: 0;
        }
        #edit-watchlist-modal .modal-content {
            min-width: 400px;
            margin-top: 0;
        }
        #delete-watchlist-modal .modal-content {
            min-width: 400px;
            margin-top: 0;
        }
        .watchlist.pinned .watchlist-controls #pin-btn {
            color: #7378c5;
        }
        .watchlist-controls button:hover {
            color: #7378c5;
        }
        .watchlist-controls button:first-child {
            order: -1;
        }
        .watchlist {
            position: relative;
            padding-top: 30px;
        }
        .watchlist.pinned {
            border: 2px solid yellow;
        }
        .watchlist-buttons-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-left: 0;
            margin-top: 35px;
            margin-bottom: 15px;
        }
        @media (max-width: 1200px) {
            #local-time {
                display: none;
            }
        }
        #button {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        #how-to-use {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 60px;
        }
        #how-to-use-btn {
            background-color: #7378c5;
            color: white;
            border-radius: 8px;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font: inherit;
            cursor: pointer;
            border: none;
        }
        #how-to-use-btn:hover {
            background-color: #ff8623;
        }
        #how-to-use-section {
            max-width: 400px;
            margin: 20px auto;
            padding: 15px;
            background-color: #7378c5;
            color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: none;
            transition: height 0.5s ease-in-out;
            margin-bottom: 240px;
        }
        #how-to-use-section:hover {
            background-color: #6e73bd;
        }
        @media (min-width: 900px) {
            #form1 {
                margin-right: 0;
            }
        }
        body {
            background-image: url("../../images/universe-1.webp");
            background-repeat: repeat-y;
            background-size: 100% auto;
        }
        @media (max-width: 767px) {
            body {
                background-size: auto;
                background-position: top center;
            }
        }
        #translate_control {
            position: fixed;
            left: 10px;
            bottom: 10px;
            z-index: 1000000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        @media (max-width: 767px) {
            #translate_control {
                display: block;
                bottom: 70px;
                position: fixed;
                left: 10px;
                z-index: 1000000;
            }
        }
        .translate-trigger {
            background-color: #7378c5;
            color: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }
        .translate-trigger:hover {
            background-color: #ff8623;
            transition: 0.1s ease-in;
        }
        #google_translate_element {
            display: none;
            position: fixed;
            left: 10px;
            bottom: 60px;
            background-color: #7378c5;
            border: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            padding: 5px;
            border-radius: 8px;
            z-index: 100000000;
            font: inherit;
            color: white;
        }
        .goog-te-combo {
            background-color: #7378c5 !important;
            color: white !important;
            border: 0.5px solid white !important;
            border-radius: 8px !important;
            font-size: 15px !important;
            padding-left: 5px !important;
        }
        .skiptranslate {
            color: white !important;
        }
        .goog-te-banner-frame {
            opacity: 0.8 !important;
            background-color: #f4f4f4 !important;
        }
        @media (max-width: 767px) {
            #google_translate_element {
                bottom: 120px;
            }
            #translate_control {
                bottom: 70px;
            }
        }
        #githubLink3 {
            color: white !important;
        }
        #githubLink3:hover {
            color: #ff8623 !important;
            transition: 0.1s ease-in;
        }
    </style>
</head>
<body>
    <div id="google_translate_element"></div>
    <div id="translate_control">
        <div class="translate-trigger">Translate</div>
    </div>

    <script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                layout: google.translate.TranslateElement.InlineLayout.VERTICAL,
                autoDisplay: false
            }, 'google_translate_element');
        }

        document.querySelector('.translate-trigger').addEventListener('click', function() {
            const translateEl = document.getElementById('google_translate_element');
            translateEl.style.display = translateEl.style.display === 'block' ? 'none' : 'block';
        });

        document.addEventListener('DOMContentLoaded', function() {
            let lastScrollTop = window.scrollY;
            const translateControl = document.getElementById('translate_control');
            const translateEl = document.getElementById('google_translate_element');

            window.addEventListener('scroll', function() {
                let scrollTop = window.scrollY;

                if (window.innerWidth <= 767) {
                    if (scrollTop > lastScrollTop && scrollTop > 0) {
                        translateControl.style.display = 'none';
                        translateEl.style.display = 'none';
                    }
                    else {
                        translateControl.style.display = 'block';
                    }
                    lastScrollTop = scrollTop;
                }
            }, { passive: true });
        })
    </script>
    <header style="margin-bottom: -30px; padding-top: 19px">
        <div id="header-title">
            <h1 id="my-heading" style="margin-bottom: -9px" class="notranslate">
                <a id="indexLink" href="../../index.html" style="text-decoration: none; color: inherit; cursor: pointer">
                    The Mo<span class="highlight" id="highlight">vieV</span>erse
                </a>
            </h1>
        </div>
        <div id="local-time" style="cursor: pointer; margin-left: 40px" title="Click to view more of your stats!">
            <p id="stats-label" class="clock" style="font-size: 16px;"></p>
            <div id="stats-display" class="clock" style="font-size: 1.25em; font-weight: bold;"></div>
        </div>
        <button id="nav-toggle" class="nav-toggle notranslate" title="Toggle side navbar" onclick="toggleNav()" style="z-index: 1000000">
            <i class="fas fa-bars"></i>
        </button>
        <button class="back-btn notranslate" onclick="window.location.href='../../index.html'">Home</button>
        <button class="about notranslate" onclick="window.location.href='about.html'">About</button>
        <button class="favorites-btn notranslate" onclick="window.location.href='favorites.html'" title="View your favorites & watchlists">Favorites</button>
        <button id="googleSignInBtn" class="nav-btn notranslate" onclick="handleSignInOut()" title="Sign In/Out">
            <span id="signInOutText">Sign In</span>
            <i class="fas fa-sign-in-alt" id="signInIcon"></i>
            <i class="fas fa-sign-out-alt" id="signOutIcon" style="display: none;"></i>
        </button>
        <button id="profileBtn" class="nav-btn notranslate" onclick="window.location.href='user-profile.html'" title="Go to your profile">
            <span id="profileText">Profile</span>
            <i class="fas fa-user" id="profileIcon"></i>
        </button>
        <form id="form1" style="margin-top: 5px">
            <div class="search-container">
                <input type="text" id="search" placeholder="Search For Films, Actors..." class="search" title="Search for movies, actors, TV series, and more!" />
                <button type="button" id="button-search" onclick="handleSearch()">Search</button>
            </div>
            <div id="search-results" class="search-results"></div>
            <div class="buttons-container">
                <button type="button" id="view-all-results" style="display: none;">View more results</button>
                <button type="button" id="clear-search" style="display: none">Clear</button>
            </div>
        </form>
    </header>

    <nav id="side-nav" class="side-nav" style="z-index: 1000000">
        <a id="heading-href" style="cursor: pointer; text-decoration: none" href="../../index.html" title="Click to go back to the home page">
            <div id="my-heading1" style="margin-bottom: 15px; margin-left: 0; margin-top: 15px; font-size: 2.1em; font-weight: bold;">
                The Mo<span class="highlight2">vieV</span>erse Menu
            </div>
        </a>
        <div id="button-container">
            <button id="button-remove" title="Close the navbar" onclick="removeNavBar()">Close</button>
        </div>
        <ul id="watchlist-links" style="overflow-y: auto">
            <li><a href="sign-in.html">Sign In</a></li>
            <li><a href="user-profile.html">Profile</a></li>
            <li><a href="analytics.html">MovieVerse Analytics</a></li>
            <li><a href="feedback.html">Submit Feedback</a></li>
            <li><a href="support.html">Contact Support</a></li>
        </ul>
    </nav>

    <div class="watchlist-buttons-container">
        <button id="create-watchlist-btn">Create Watch Lists</button>
        <button id="edit-watchlist-btn">Edit Watch Lists</button>
        <button id="delete-watchlist-btn">Delete Watch Lists</button>
    </div>

    <div id="create-watchlist-modal" class="modal" style="z-index: 1000000000">
        <div class="modal-content">
            <span class="close-button" title="Close this modal" onclick="closeModal('create-watchlist-modal')">&times;</span>
            <h2>Create a Watch List</h2>
            <form id="create-watchlist-form">
                <label>Name:</label>
                <input type="text" id="new-watchlist-name" placeholder="Watchlist's Name" style="font: inherit" required>
                <div style="height: 20px"></div>
                <label>Description:</label>
                <textarea placeholder="Watchlist Description" id="new-watchlist-description" style="font: inherit"></textarea>
                <button type="submit" id="button" style="display: block; margin-left: auto; color: white; margin-right: auto;">Create</button>
            </form>
        </div>
    </div>

    <div id="myModal" class="modal-overlay">
        <div class="spinner"></div>
    </div>

    <div id="edit-watchlist-modal" class="modal" style="z-index: 1000000000">
        <div class="modal-content">
            <span class="close-button" title="Close this modal" onclick="closeModal('edit-watchlist-modal')">&times;</span>
            <h2>Edit a Watch List</h2>
            <form id="edit-watchlist-form">
                <!-- Dynamically populate this form based on user selection -->
            </form>
        </div>
    </div>

    <div id="delete-watchlist-modal" class="modal" style="z-index: 1000000000">
        <div class="modal-content">
            <span class="close-button" title="Close this modal" onclick="closeModal('delete-watchlist-modal')">&times;</span>
            <h2>Delete Watch Lists</h2>
            <label>Select watch lists to delete:</label>
            <form id="delete-watchlist-form">
                <!-- Dynamically populate this form based on user selection -->
            </form>
        </div>
    </div>

    <div id="watchlists-display-section">
        <!-- Dynamically populated watch lists will go here -->
    </div>

    <main id="favorites-main" style="margin-top: 75px; text-align: center"></main>
    <main id="favorites-main-tv" style="margin-top: 75px; text-align: center"></main>

    <div id="how-to-use">
        <button id="how-to-use-btn">How to Use</button>
    </div>

    <div id="how-to-use-section" style="display: none; text-align: center; padding: 20px; margin-top: 20px;">
        <h4 style="color: white">How to Use MovieVerse Watchlists</h4>
        <p>To start creating a watchlist, add movies and TV series to your favorites by clicking the heart icon on their pages. Your favorites serve as a pool for building watchlists.</p>
        <p>Once you have favorites, you can create a watchlist. Select items from your favorites, then name and describe your watchlist. You can later edit or delete any watchlist through the corresponding "Edit" or "Delete" options.</p>
        <p>Editing a watchlist allows you to modify its name, description, and contents. Select the watchlist to edit from the dropdown menu, make your changes, and save them to update your watchlist.</p>
        <p>For seamless access across devices, sign in to your MovieVerse account. This ensures your favorites and watchlists are stored in our database and can be accessed anytime, anywhere. Without signing in, your data is stored locally and will sync upon your next sign-in.</p>
        <p><em>Note: if you sign in for the first time without any previously signed-in account, any locally stored favorites and watchlists will be replaced by your account data. To avoid losing data, consider backing it up or noting it down before signing in.</em></p>
        <p style="font-weight: bold; margin-top: 30px">Enjoy using MovieVerse Watchlists! 🍿🎬</p>
    </div>

    <div id="ad-container1" style="text-align: center; cursor: pointer; background-color: rgba(255, 255, 255, 0.15); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin: 20px auto; padding: 10px; border-radius: 8px; width: auto; max-width: calc(100% - 40px)" title="Displaying ads helps us maintain our websites, servers, and databases to provide you with free services. Thank you for your support!">
        <p style="margin: 0;">Advertisement</p>
        <ins class="adsbygoogle"
             style="display: block; width: 100%;"
             data-ad-client="ca-pub-6608388491200814"
             data-ad-slot="4832732030"
             data-ad-format="auto"></ins>
        <p style="margin: 0; font-size: 12px; margin-top: 5px">Displaying ads helps us maintain our websites, servers, and databases to provide you with free services. Submit your <a style="text-decoration: underline" id="githubLink" href="/MovieVerse-Frontend/html/feedback.html">feedback</a> if you find the ad inappropriate or irrelevant.</p>
    </div>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

    <div id="ad-container2" style="text-align: center; cursor: pointer; background-color: rgba(255, 255, 255, 0.15); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); margin: 20px auto; padding: 10px; border-radius: 8px; width: auto; max-width: calc(100% - 40px)" title="Displaying ads helps us maintain our websites, servers, and databases to provide you with free services. Thank you for your support!">
        <p style="margin: 0;">Advertisement</p>
        <ins class="adsbygoogle"
             style="display: block; width: 100%;"
             data-ad-client="ca-pub-6608388491200814"
             data-ad-slot="4832732030"
             data-ad-format="auto"></ins>
        <p style="margin: 0; font-size: 12px; margin-top: 5px">Displaying ads helps us maintain our websites, servers, and databases to provide you with free services. Submit your <a style="text-decoration: underline" id="githubLink3" href="/MovieVerse-Frontend/html/feedback.html">feedback</a> if you find the ad inappropriate or irrelevant.</p>
    </div>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <button id="chat-button" onclick="window.location.href='chat.html'" style="bottom: 335px; right: 10px; z-index: 1001" title="Chat with fellow MovieVerse users!">Chat</button>
    <button id="settings-btn" onclick="window.location.href='settings.html'" style="position: fixed; bottom: 300px; right: 10px; z-index: 10012">Settings</button>
    <button id="movie-of-the-day-btn" onclick="showMovieOfTheDay()" title="Get a recommended movie to watch for today!" style="bottom: 265px; right: 10px; z-index: 10012">Surprise Me!</button>
    <button id="movie-match-btn3" onclick="window.location.href='movie-match.html'" title="Find a movie that matches your mood, genre, and time period!" style="bottom: 230px; right: 10px; z-index: 10012">Movie Match</button>
    <button id="movie-timeline-btn" onclick="window.location.href='movie-timeline.html'" title="Explore movies through different eras!" style="bottom: 195px; right: 10px; z-index: 10012">Movie Timeline</button>
    <button id="discussions-btn" onclick="window.location.href='chatbot.html'" style="bottom: 160px; right: 10px; z-index: 10012" title="Chat with our intelligent chatbot!">MovieVerse Chatbot</button>
    <button id="trivia-btn" onclick="window.location.href='trivia.html'" style="bottom: 125px; right: 10px; z-index: 10012" title="Test your movie knowledge">MovieVerse Trivia</button>
    <button id="back-to-top-btn" title="Go to top" style="bottom: 90px; right: 10px; z-index: 10012" onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">Back to Top</button>
    <script src="../js/movie-details.js"></script>
    <footer>
        <a href="../../index.html" style="cursor: pointer; text-decoration: none">
            <p style="cursor: pointer; text-decoration: none">© 2024 The MovieVerse. All rights reserved.</p>
        </a>
    </footer>
    <div id="mobile-bottom-bar" class="mobile-bottom-bar">
        <a href="chat.html" class="bottom-bar-item">
            <i class="fas fa-comments"></i>
            <span>Chat</span>
        </a>
        <a href="settings.html" class="bottom-bar-item">
            <i class="fas fa-cog"></i>
            <span>Settings</span>
        </a>
        <a href="#" class="bottom-bar-item" onclick="showMovieOfTheDay()">
            <i class="fas fa-surprise"></i>
            <span>Surprise Me</span>
        </a>
        <a href="movie-match.html" class="bottom-bar-item">
            <i class="fas fa-film"></i>
            <span>Match</span>
        </a>
        <a href="movie-timeline.html" class="bottom-bar-item">
            <i class="fas fa-clock"></i>
            <span>Timeline</span>
        </a>
        <a href="chatbot.html" class="bottom-bar-item">
            <i class="fas fa-robot"></i>
            <span>Chatbot</span>
        </a>
        <a href="trivia.html" class="bottom-bar-item">
            <i class="fas fa-question-circle"></i>
            <span>Trivia</span>
        </a>
        <a href="#" class="bottom-bar-item" onclick="window.scrollTo({ top: 0, behavior: 'smooth' })">
            <i class="fas fa-arrow-up"></i>
            <span>Top</span>
        </a>
    </div>
    <button id="menu-btn" style="position: fixed; bottom: 10px; right: 10px; z-index: 1001" title="Toggle Menu Buttons">
        <i class="fas fa-ellipsis-h"></i><br>
        <span>Menu</span>
    </button>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js';
        import { getFirestore, doc, setDoc, collection, updateDoc, getDocs, getDoc, query, where, orderBy, writeBatch, deleteDoc } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js';

        let initialMoviesSelection = [];
        let initialTVSeriesSelection = [];

        function translateFBC(value) {
            return atob(value);
        }

        function getFBConfig1() {
            const fbConfig1 = "QUl6YVN5REw2a1FuU2ZVZDhVdDhIRnJwS3VpdnF6MXhkWG03aw==";
            return translateFBC(fbConfig1);
        }

        function getFBConfig2() {
            const fbConfig2 = "bW92aWV2ZXJzZS1hcHAuZmlyZWJhc2VhcHAuY29t";
            return translateFBC(fbConfig2);
        }

        function getFBConfig3() {
            const fbConfig3 = "bW92aWV2ZXJzZS1hcHAuYXBwc3BvdC5jb20=";
            return translateFBC(fbConfig3);
        }

        function getFBConfig4() {
            const fbConfig4 = "ODAyOTQzNzE4ODcx";
            return translateFBC(fbConfig4);
        }

        function getFBConfig5() {
            const fbConfig5 = "MTo4MDI5NDM3MTg4NzE6d2ViOjQ4YmM5MTZjYzk5ZTI3MjQyMTI3OTI=";
            return translateFBC(fbConfig5);
        }

        const firebaseConfig = {
            apiKey: getFBConfig1(),
            authDomain: getFBConfig2(),
            projectId: "movieverse-app",
            storageBucket: getFBConfig3(),
            messagingSenderId: getFBConfig4(),
            appId: getFBConfig5()
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadNavWatchlistLinks() {
            const navList = document.getElementById('watchlist-links');
            const firstStaticItem = navList.querySelector('li');

            try {
                showSpinner();

                const currentUserEmail = localStorage.getItem('currentlySignedInMovieVerseUser');
                let watchlists = [];

                if (currentUserEmail) {
                    const q = query(collection(db, "watchlists"), where("userEmail", "==", currentUserEmail));
                    const querySnapshot = await getDocs(q);
                    watchlists = querySnapshot.docs.map(doc => ({ id: doc.id, name: doc.data().name }));
                }
                else {
                    watchlists = JSON.parse(localStorage.getItem('localWatchlists')) || [];
                }

                watchlists.push({ name: "Favorite Movies", id: "favorites-watchlist" });
                watchlists.push({ name: "Favorite TV Series", id: "favorites-tvseries-watchlist" });

                navList.querySelectorAll('li.dynamic').forEach(li => li.remove());

                let counter = 1;

                watchlists.forEach(watchlist => {
                    const listItem = document.createElement('li');
                    listItem.className = 'dynamic';
                    const link = document.createElement('a');
                    link.href = `#${watchlist.name.replace(/\s+/g, '-').toLowerCase()}`;

                    if (watchlist.name !== "Favorite Movies" && watchlist.name !== "Favorite TV Series") {
                        link.textContent = `Watchlist ${counter}: ${watchlist.name}`;
                        counter++;
                    }
                    else {
                        link.textContent = watchlist.name;
                    }

                    listItem.appendChild(link);
                    navList.insertBefore(listItem, firstStaticItem);
                });

                hideSpinner();
                assignIdsToWatchlists();
            }
            catch (error) {
                console.error('Error loading watchlists for navigation:', error);
                hideSpinner();
            }
        }

        function assignIdsToWatchlists() {
            document.querySelectorAll('.watchlist').forEach(watchlist => {
                const title = watchlist.querySelector('.watchlist-title').textContent.trim();
                if (!watchlist.id) {
                    watchlist.id = title.replace(/\s+/g, '-').toLowerCase();
                }
            });
        }

        document.addEventListener('DOMContentLoaded', loadNavWatchlistLinks);
    </script>
    <script>
        function toggleNav() {
            const sideNav = document.getElementById('side-nav');
            sideNav.classList.toggle('manual-toggle');
            adjustNavBar();
        }

        function removeNavBar() {
            const sideNav = document.getElementById('side-nav');
            if (sideNav.classList.contains('manual-toggle')) {
                sideNav.classList.remove('manual-toggle');
            }

            adjustNavBar();
        }

        function adjustNavBar() {
            const sideNav = document.getElementById('side-nav');
            if (sideNav.classList.contains('manual-toggle')) {
                sideNav.style.left = '0px';
            }
            else {
                sideNav.style.left = '-250px';
            }
        }

        document.addEventListener('mousemove', function(event) {
            const sideNav = document.getElementById('side-nav');
            if (event.clientX < 10 && !sideNav.classList.contains('manual-toggle')) {
                sideNav.style.left = '0';
            }
        });

        document.getElementById('side-nav').addEventListener('mouseleave', function() {
            const sideNav = document.getElementById('side-nav');
            if (!sideNav.classList.contains('manual-toggle')) {
                sideNav.style.left = '-250px';
            }
        });

        document.addEventListener('click', function(event) {
            const sideNav = document.getElementById('side-nav');
            const navToggle = document.getElementById('nav-toggle');
            if (!sideNav.contains(event.target) && !navToggle.contains(event.target) && sideNav.classList.contains('manual-toggle')) {
                sideNav.classList.remove('manual-toggle');
                adjustNavBar();
            }
        });

        function handleSignInOut() {
            const isSignedIn = JSON.parse(localStorage.getItem('isSignedIn')) || false;

            if (isSignedIn) {
                localStorage.setItem('isSignedIn', JSON.stringify(false));
                alert('You have been signed out.');
            }
            else {
                window.location.href = 'sign-in.html';
                return;
            }

            updateSignInButtonState();
        }

        function updateSignInButtonState() {
            const isSignedIn = JSON.parse(localStorage.getItem('isSignedIn')) || false;

            const signInText = document.getElementById('signInOutText');
            const signInIcon = document.getElementById('signInIcon');
            const signOutIcon = document.getElementById('signOutIcon');

            if (isSignedIn) {
                signInText.textContent = 'Sign Out';
                signInIcon.style.display = 'none';
                signOutIcon.style.display = 'inline-block';
            }
            else {
                signInText.textContent = 'Sign In';
                signInIcon.style.display = 'inline-block';
                signOutIcon.style.display = 'none';
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            updateSignInButtonState();
            document.getElementById('googleSignInBtn').addEventListener('click', handleSignInOut);
        });

        window.addEventListener('load', function() {
            adjustAnchorHeights();
        });

        window.addEventListener('resize', adjustAnchorHeights);

        function adjustAnchorHeights() {
            const bottomBarAnchors = document.querySelectorAll('.mobile-bottom-bar a');
            let maxHeight = 0;

            bottomBarAnchors.forEach(anchor => {
                anchor.style.height = 'auto';
                const anchorHeight = anchor.getBoundingClientRect().height;
                maxHeight = Math.max(maxHeight, anchorHeight);
            });

            bottomBarAnchors.forEach(anchor => {
                anchor.style.height = `${maxHeight}px`;
            });
        }

        let lastScrollY = window.scrollY;

        window.addEventListener('scroll', () => {
            const currentScrollY = window.scrollY;

            if (currentScrollY > lastScrollY && currentScrollY > 0) {
                document.querySelector('.mobile-bottom-bar').classList.add('hide-bar');
            }
            else {
                document.querySelector('.mobile-bottom-bar').classList.remove('hide-bar');
            }

            lastScrollY = currentScrollY;
        });

        let isAnimating = false;

        document.getElementById('menu-btn').addEventListener('click', () => {
            if (isAnimating) return;

            isAnimating = true;

            const buttonIds = [
                'chat-button',
                'settings-btn',
                'movie-of-the-day-btn',
                'movie-match-btn3',
                'movie-timeline-btn',
                'discussions-btn',
                'trivia-btn',
                'back-to-top-btn'
            ];

            buttonIds.forEach((id, index) => {
                const button = document.getElementById(id);
                if (button.style.display === 'none' || !button.style.display) {
                    button.style.display = 'block';
                    setTimeout(() => {
                        button.style.opacity = '1';
                        button.style.transform = 'translateY(0)';
                    }, 50 * index);
                } else {
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                }

                setTimeout(() => {
                    button.style.display = button.style.opacity === '1' ? 'block' : 'none';
                    if (index === buttonIds.length - 1) {
                        isAnimating = false;
                    }
                }, 500 + 50 * index);
            });
        });

        window.addEventListener('resize', () => {
            if (window.innerWidth < 767) {
                const buttonIds = [
                    'chat-button',
                    'settings-btn',
                    'movie-of-the-day-btn',
                    'movie-match-btn3',
                    'movie-timeline-btn',
                    'discussions-btn',
                    'trivia-btn',
                    'back-to-top-btn'
                ];

                buttonIds.forEach(id => {
                    const button = document.getElementById(id);
                    button.style.display = 'none';
                    button.style.opacity = '0';
                    button.style.transform = 'translateY(20px)';
                });
            }
        });
    </script>
    <div id="myModal" class="modal-overlay">
        <div class="spinner"></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchBar = document.getElementById('search');
            const searchButton = document.getElementById('button-search');
            const myHeading = document.getElementById('my-heading');
            const localTime = document.getElementById('local-time');

            function toggleVisibility() {
                const query = searchBar.value.trim();
                if (query) {
                    if (window.innerWidth > 800) {
                        myHeading.style.visibility = 'hidden';
                        myHeading.style.opacity = '0';
                        localTime.style.visibility = 'hidden';
                        localTime.style.opacity = '0';
                    }
                }
                else {
                    myHeading.style.visibility = 'visible';
                    myHeading.style.opacity = '1';
                    localTime.style.visibility = 'visible';
                    localTime.style.opacity = '1';
                }
            }
            searchBar.addEventListener('input', toggleVisibility);
            toggleVisibility();
        });
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search');
            const viewAllResultsBtn = document.getElementById('view-all-results');
            const clearSearchBtn = document.getElementById('clear-search');
            const searchResultsContainer = document.getElementById('search-results');
            const myHeading = document.getElementById('my-heading');
            const localTime = document.getElementById('local-time');
            const searchButton = document.getElementById('button-search');

            function toggleButtons() {
                const query = searchInput.value.trim();
                viewAllResultsBtn.style.display = query ? 'inline-block' : 'none';
                clearSearchBtn.style.display = query ? 'inline-block' : 'none';
            }

            clearSearchBtn.addEventListener('click', function() {
                searchInput.value = '';
                searchResultsContainer.innerHTML = '';
                toggleButtons();
                searchInput.focus();

                myHeading.style.visibility = 'visible';
                myHeading.style.opacity = '1';
                localTime.style.visibility = 'visible';
                localTime.style.opacity = '1';
            });

            toggleButtons();
            searchInput.addEventListener('input', toggleButtons);
        });
    </script>
    <script>
        function showSpinner() {
            document.getElementById('myModal').classList.add('modal-visible');
        }

        function hideSpinner() {
            document.getElementById('myModal').classList.remove('modal-visible');
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('search').addEventListener('input', function(e) {
                showSpinner();
                const viewAllResultsBtn = document.getElementById('view-all-results');
                const searchInput = document.getElementById('search');
                const query = e.target.value.trim();
                const searchResultsContainer = document.getElementById('search-results');

                viewAllResultsBtn.style.display = query ? 'block' : 'none';

                function toggleButtons() {
                    viewAllResultsBtn.style.display = query ? 'inline-block' : 'none';
                    const clearSearchBtn = document.getElementById('clear-search');
                    clearSearchBtn.style.display = query ? 'inline-block' : 'none';
                }

                if (query) {
                    const searchURL = `https://${getMovieVerseData()}/3/search/multi?${generateMovieNames()}${getMovieCode()}&query=${encodeURIComponent(query)}`;
                    fetch(searchURL)
                        .then(response => response.json())
                        .then(data => {
                            const sortedResults = data.results.sort((a, b) => b.popularity - a.popularity);
                            displaySearchResults(sortedResults.slice(0, 5));
                        })
                        .catch(err => console.log("Fetching error:", err));
                }
                else {
                    searchInput.value = '';
                    searchResultsContainer.innerHTML = '';
                    toggleButtons();
                    searchInput.focus();
                }

                searchInput.addEventListener('input', function() {
                    if (searchInput.value.trim()) {
                        viewAllResultsBtn.style.display = 'block';
                    }
                    else {
                        viewAllResultsBtn.style.display = 'none';
                    }
                });

                viewAllResultsBtn.addEventListener('click', function() {
                    const searchQuery = searchInput.value.trim();
                    if (searchQuery) {
                        localStorage.setItem('searchQuery', searchQuery);
                        window.location.href = 'search.html';
                    }
                    else {
                        alert('Please enter a search query.');
                    }
                });

                hideSpinner();
            });

            function displaySearchResults(results) {
                showSpinner();
                const resultsContainer = document.getElementById('search-results');
                resultsContainer.innerHTML = '';

                results.forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'search-result-card';
                    card.style.cursor = 'pointer';

                    const imagePath = item.poster_path || item.profile_path ? `https://image.tmdb.org/t/p/w500${item.poster_path || item.profile_path}` : null;

                    if (imagePath) {
                        const image = document.createElement('img');
                        image.src = imagePath;
                        image.className = 'result-image';
                        card.appendChild(image);
                    }
                    else {
                        const placeholder = document.createElement('div');
                        placeholder.className = 'result-image-placeholder';
                        placeholder.textContent = 'Image Not Available';
                        placeholder.style.textAlign = 'center';
                        placeholder.style.padding = '10px';
                        card.appendChild(placeholder);
                    }

                    const details = document.createElement('div');
                    details.className = 'result-details';

                    const name = document.createElement('div');
                    name.className = 'result-name';
                    name.textContent = item.title || item.name;
                    details.appendChild(name);

                    const type = document.createElement('div');
                    type.className = 'result-type';
                    type.textContent = item.media_type === 'movie' ? 'Movie' : item.media_type === 'tv' ? 'TV Series' : 'Person';
                    details.appendChild(type);

                    card.appendChild(details);
                    resultsContainer.appendChild(card);

                    card.addEventListener('click', () => handleResultClick(item));
                });

                hideSpinner();
            }

            async function handleResultClick(item) {
                console.log('Clicked item:', item.media_type, item.id);

                if (!item.media_type) {
                    console.log('Media type is undefined');
                    return;
                }

                if (item.media_type === 'movie') {
                    localStorage.setItem('selectedMovieId', item.id);
                    window.location.href = 'movie-details.html';
                }
                else if (item.media_type === 'tv') {
                    localStorage.setItem('selectedTvSeriesId', item.id);
                    window.location.href = 'tv-details.html';
                }
                else if (item.media_type === 'person') {
                    try {
                        const personDetailsUrl = `https://${getMovieVerseData()}/3/person/${item.id}?${generateMovieNames()}${getMovieCode()}`;
                        const response = await fetch(personDetailsUrl);
                        const personDetails = await response.json();

                        if (personDetails.known_for_department === 'Directing') {
                            localStorage.setItem('selectedDirectorId', item.id);
                            window.location.href = 'director-details.html?' + item.id;
                        }
                        else {
                            localStorage.setItem('selectedActorId', item.id);
                            window.location.href = 'actor-details.html?' + item.id;
                        }
                    }
                    catch (error) {
                        console.log('Error fetching person details:', error);
                    }
                }
                else {
                    console.log('Unknown media type:', item.media_type);
                }
            }
        });

        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('search');
            const viewAllResultsBtn = document.getElementById('view-all-results');
            const clearSearchBtn = document.getElementById('clear-search');
            const searchResultsContainer = document.getElementById('search-results');
            let selectedIndex = -1;

            function clearSelection() {
                const results = searchResultsContainer.getElementsByClassName('search-result-card');
                if (selectedIndex >= 0 && selectedIndex < results.length) {
                    results[selectedIndex].style.backgroundColor = '';
                }
                else if (selectedIndex === results.length) {
                    viewAllResultsBtn.style.backgroundColor = '';
                }
                else if (selectedIndex === results.length + 1) {
                    clearSearchBtn.style.backgroundColor = '';
                }
            }

            function moveSelection(direction) {
                const results = searchResultsContainer.getElementsByClassName('search-result-card');
                const totalElements = results.length + 2;
                clearSelection();

                if (direction === 'down') {
                    selectedIndex = (selectedIndex + 1) % totalElements;
                }
                else if (direction === 'up') {
                    selectedIndex = (selectedIndex - 1 + totalElements) % totalElements;
                }

                if (selectedIndex < results.length) {
                    results[selectedIndex].style.backgroundColor = '#ff8623';
                    results[selectedIndex].scrollIntoView({ block: "nearest" });
                }
                else if (selectedIndex === results.length) {
                    viewAllResultsBtn.style.backgroundColor = '#ff8623';
                    viewAllResultsBtn.scrollIntoView({ block: "nearest" });
                }
                else if (selectedIndex === results.length + 1) {
                    clearSearchBtn.style.backgroundColor = '#ff8623';
                    clearSearchBtn.scrollIntoView({ block: "nearest" });
                }
            }

            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'ArrowDown' || (e.key === 'Tab' && !e.shiftKey)) {
                    e.preventDefault();
                    moveSelection('down');
                }
                else if (e.key === 'ArrowUp' || (e.key === 'Tab' && e.shiftKey)) {
                    e.preventDefault();
                    moveSelection('up');
                }
                else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (selectedIndex >= 0 && selectedIndex < searchResultsContainer.getElementsByClassName('search-result-card').length) {
                        searchResultsContainer.getElementsByClassName('search-result-card')[selectedIndex].click();
                    }
                    else if (selectedIndex === searchResultsContainer.getElementsByClassName('search-result-card').length) {
                        viewAllResultsBtn.click();
                    }
                    else if (selectedIndex === searchResultsContainer.getElementsByClassName('search-result-card').length + 1) {
                        clearSearchBtn.click();
                    }
                    else {
                        const query = searchInput.value.trim();
                        localStorage.setItem('searchQuery', query);
                        window.location.href = 'search.html';
                    }
                }
            });

            searchInput.addEventListener('blur', clearSelection);
        });
    </script>
</body>
</html>
